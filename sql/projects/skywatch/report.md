# Skywatch Database Report

This report provides a summary of the `skywatch.sql` script, including the database schema and a breakdown of the various SQL queries used.

## Database Schema

### `Stations` Table
Stores information about the weather stations.

| Column | Data Type | Constraints |
| --- | --- | --- |
| `station_id` | INT | PRIMARY KEY |
| `station_name` | VARCHAR(255) | UNIQUE |
| `owner_name` | VARCHAR(255) | |
| `owner_phone` | INT | |
| `installed_date`| DATE | |
| `is_active` | VARCHAR(3) | |

### `Locations` Table
Stores the geographical location of each station.

| Column | Data Type | Constraints |
| --- | --- | --- |
| `location_id` | INT | PRIMARY KEY |
| `station_id` | INT | FOREIGN KEY (references `Stations`) |
| `latitude` | DECIMAL | |
| `logitude` | DECIMAL | |
| `altitude_m` | INT | |
| `pleace_name` | VARCHAR(255)| |

### `Sensors` Table
Stores data about the sensors at each station.

| Column | Data Type | Constraints |
| --- | --- | --- |
| `sensor_id` | INT | PRIMARY KEY |
| `station_id` | INT | FOREIGN KEY (references `Stations`) |
| `sensor_type` | VARCHAR(20) | |
| `model` | VARCHAR(30) | |
| `last_calibrated`| DATE | |
| `status` | VARCHAR(50) | Added via `ALTER TABLE` |

### `Weather_readings` Table
Stores the data collected by the sensors.

| Column | Data Type | Constraints |
| --- | --- | --- |
| `reading_id` | TIMESTAMP | PRIMARY KEY |
| `sensor_id` | INT | FOREIGN KEY (references `Sensors`) |
| `recorded_at` | DATETIME | |
| `temperature_c` | DECIMAL | |
| `humidity_percent`| DECIMAL | |
| `pressure_hpa` | DECIMAL | |
| `rain_mm` | DECIMAL | |
| `wind_speed_kmh`| DECIMAL | |
| `soil_moisture` | INT | |

### `Daily_summaries` Table
Stores daily summary data for each station.

| Column | Data Type | Constraints |
| --- | --- | --- |
| `summary_id` | INT | IDENTITY, PRIMARY KEY |
| `station_id` | INT | FOREIGN KEY (references `Stations`) |
| `daily_date` | DATE | |
| `min_temp` | DECIMAL | |
| `max_temp` | DECIMAL | |
| `total_rain_mm`| DECIMAL | |
| `avg_humidity`| DECIMAL | |

### `Alerts` Table
Stores alerts generated by the system.

| Column | Data Type | Constraints |
| --- | --- | --- |
| `alert_id` | INT | IDENTITY, PRIMARY KEY |
| `station_id` | INT | FOREIGN KEY (references `Stations`) |
| `alert_type` | VARCHAR(50) | |
| `alert_message`| VARCHAR(300)| |
| `sent_at` | DATETIME | |
| `acknowledged`| VARCHAR(3) | |

## SQL Queries

### `ALTER TABLE` and `UPDATE`
The `Sensors` table was altered to include a `status` column. This column is then updated based on the `last_calibrated` date.

```sql
-- ALTER TABLE: Add a new column 'status' to the Sensors table
ALTER TABLE Sensors
ADD status VARCHAR(50);

-- UPDATE: Populate the new 'status' column
UPDATE Sensors
SET status = 'Active'
WHERE last_calibrated > '2025-02-01';

UPDATE Sensors
SET status = 'Needs Calibration'
WHERE last_calibrated <= '2025-02-01';
```

### `JOIN`
This query joins the `Stations` and `Locations` tables to display the name and location of each station.

```sql
-- JOIN: Select all stations and their locations
SELECT
    s.station_name,
    l.pleace_name,
    l.latitude,
    l.logitude
FROM
    Stations s
JOIN
    Locations l ON s.station_id = l.station_id;
```

### `SELECT` with `WHERE`
This query selects all active stations.

```sql
-- SELECTION with WHERE: Select all active stations
SELECT
    station_name,
    owner_name,
    installed_date
FROM
    Stations
WHERE
    is_active = 'yes';
```
### `GROUP BY`
This query groups the data by sensor type and calculates the average, maximum, and minimum temperature for each type.

```sql
-- GROUPING: Get the average, max, and min temperature for each sensor type
SELECT
    s.sensor_type,
    AVG(wr.temperature_c) AS avg_temp,
    MAX(wr.temperature_c) AS max_temp,
    MIN(wr.temperature_c) AS min_temp
FROM
    Sensors s
JOIN
    Weather_readings wr ON s.sensor_id = wr.sensor_id
GROUP BY
    s.sensor_type;
```
### `ORDER BY`
This query lists all stations, ordered by their installation date in descending order.

```sql
-- ORDER BY: Select all stations ordered by their installation date
SELECT
    station_name,
    installed_date
FROM
    Stations
ORDER BY
    installed_date DESC;
```

### Sub-query
This query finds all sensors that have recorded a temperature higher than the overall average temperature.

```sql
-- SUB-QUERY: Select sensors that have recorded temperatures above the average temperature
SELECT
    sensor_id,
    sensor_type,
    model
FROM
    Sensors
WHERE
    sensor_id IN (
        SELECT
            sensor_id
        FROM
            Weather_readings
        WHERE
            temperature_c > (SELECT AVG(temperature_c) FROM Weather_readings)
    );
```

### Arithmetic Operation
This query converts the temperature from Celsius to Fahrenheit.
```sql
-- OPERATION: Select weather readings and convert temperature from Celsius to Fahrenheit
SELECT
    reading_id,
    temperature_c,
    (temperature_c * 9/5) + 32 AS temperature_f
FROM
    Weather_readings;
```
